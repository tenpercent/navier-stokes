<!--- type: markdown; required-extensions: mathjax smarty --->
<!--- Created with ReText: http://retext.sourceforge.net/ --->

Отчёт о численном решении системы уравнений Навье--Стокса.

## Постановка задачи

Дана система уравнений, описывающая одномерное нестационарное движение вязкого
баротропного газа:

$$
\left\{
\begin{align*}
& \frac{\partial\rho}{\partial t} + \frac{\partial\rho u}{\partial x} = 0,\\
& \rho\frac{\partial u}{\partial t} + \rho u\frac{\partial u}{\partial x} +
  \frac{\partial p}{\partial x} = \mu\frac{\partial^2 u}{\partial x^2} + \rho f
\end{align*}
\right.
$$

### Начальные условия в задачах № 1 и № 2

$$
\rho(x,\,0) = \rho_0(x) \\
u(x,\,0) = u_0(x) \\
u(0,\,t) = 0 \\
u(X,\,t) = 0
$$

### Начальные условия в задаче № 3

$$
\rho(x,\,0) =
\begin{cases}
1{,} & x \in (0,\,4.5) \\
2{,} & x \in (4.5,\,5.5) \\
1{,} & x \in (5.5,\,10)
\end{cases}
$$

$$
u(x,\,0) = 0{,}\quad x \in (0,\,10)
$$

$$
u(0,\,t) = 0 \\
u(10,\,t) = 0
$$

### Начальные условия в задаче № 4

$$
\rho(x,\,0) =
\begin{cases}
0{,} & x \in (0,\,4.5) \\
1{,} & x \in (4.5,\,5.5) \\
0{,} & x \in (5.5,\,10)
\end{cases}
$$

$$
u(x,\,0) = 1{,}\quad x \in (0,\,10)
$$

$$
u(0{,}\,t) = 0 \\
u(10{,}\,t) = 0
$$

### Обозначения

Переменная | Описание
---------- | --------
$x$        | пространственная координата
$t$        | время
$\rho$     | плотность газа
$p$        | давление газа, $p = p(\rho)$
$g$        | сокращение для $\ln p$
$u$        | скорость газа
$\mu$      | вязкость газа
$f$        | внешняя сила

### Линейная система

Пусть $G_m$, $V_m$ --- значения сеточных приближений функций $g$ и $u$
на $m$-ом узле, $m = 0, \dots, M$.

Возьмём

$$
\tilde\rho(x,\,t) = e^t \left( \cos \frac{\pi x}{10} + \frac{3}{2} \right), \\
\tilde{u}(x,\,t) = \cos 2\pi t \cdot \sin \frac{\pi x^2}{100}
$$

За $R_1(m)$ и $R_2(m)$ обозначим результаты применения дифференциальных
операторов из левой части системы к функциям $\tilde\rho$ и $\tilde{u}$.

Получим систему $2M+2$ уравнений с $2M+2$ неизвестными.

Линейное уравнение для $G$:

$$
- \hat{G}_{m-1} \cdot \frac{V_{m-1} + V_m}{4h}
- \hat{V}_{m-1} \cdot \frac{1}{2h}
+ \hat{G}_{m}   \cdot \frac{1}{\tau}
+ \hat{G}_{m+1} \cdot \frac{V_m + V_{m+1}}{4h}
+ \hat{V}_{m+1} \cdot \frac{1}{2h} = \\
= \frac{G_m}{\tau} + G_m \cdot \frac{V_{m+1} - V_{m-1}}{4h} +
  R_1(m)
$$

Начальное условие:

$$
  \hat{G}_0 \cdot \left( \frac{1}{\tau} - \frac{V_0}{2h} \right)
- \hat{V}_0 \cdot \frac{1}{h}
+ \hat{G}_1 \cdot \frac{V_1}{2h}
+ \hat{V}_1 \cdot \frac{1}{h} = \\
= \frac{G_0}{\tau} + G_0 \cdot \frac{V_1 - V_0}{2h} +
  \frac{G_2 V_2 - 2 G_1 V_1 + G_0 V_0 +
      \left( 2 - G_0 \right) \left( V_2 - 2 V_1 + V_0 \right)}{4h} +
  R_1(0)
$$

Конечное условие:

$$
- \hat{G}_{M-1} \cdot \frac{V_{M-1}}{2h}
- \hat{V}_{M-1} \cdot \frac{1}{h}
+ \hat{G}_{M}   \cdot \left( \frac{1}{\tau} + \frac{V_M}{2h} \right)
+ \hat{V}_{M}   \cdot \frac{1}{h} = \\
= \frac{G_M}{\tau} +
  \frac{G_M \left( V_M - V_{M-1} \right) }{2h} +
  \frac{G_M V_M - 2 G_{M-1} V_{M-1} + G_{M-2} V_{M-2} +
      \left( 2 - G_M \right) \left( V_M - 2 V_{M-1} + V_{M-2} \right) }{4h} +
  R_1(M)
$$

Линейное уравнение для $V$ (в случае нулевой вязкости):

$$
- \hat{G}_{m-1} \cdot \frac{\tilde{p}'}{2h}
- \hat{V}_{m-1} \cdot \left( \frac{V_{m-1} + V_m}{6h} + \frac{4}{3}\tilde\mu \right)
+ \hat{V}_{m}   \cdot \left( \frac{1}{\tau} + \frac{8}{3} \tilde\mu \right)
+ \hat{G}_{m+1} \cdot \frac{\tilde{p}'}{2h} = \\
+ \hat{V}_{m+1} \cdot \left( \frac{V_m + V_{m+1}}{6h} - \frac{4}{3}\tilde\mu \right)
= \frac{V_m}{\tau} +
  R_2(m)
$$

Оставшиеся два уравнения берутся из условий $\hat{V}_0$ = 0, $\hat{V}_M$ = 0.

## Организация хранения матрицы и векторов

Значения $G$ и $V$ располагаются по очереди: $G_0 V_0 G_1 V_1 \dots G_M V_M$.

Поскольку на главной диагонали все элементы с индексами одинаковой чётности
равны между собой, то из диагональной части матрицы хранятся только два элемента.

Остальные элементы хранятся в формате Modified Compressed Sparse Row (MSR),
в виде массива индексов и массива значений длины $S + 3$, где $S = 10M$ ---
количество ненулевых элементов.

Общее потребление памяти составляет $11M + 5$ значений и $10M + 3$ индексов.

## Методы решения разреженных линейных систем

В программе реализован метод BiCGSTAB (стабилизированный метод бисопряжённых
градиентов) с предобуславливателем.

Кроме того, возможно подключение библиотеки LASPack, в которой реализованы
другие итерационные методы и предобуславливатели.

### Алгоритм метода BiCGSTAB

Пусть $A$ --- матрица системы, $\mathbf b$ --- правая часть, $\mathbf x$ ---
начальное приближение системы, $K$ --- матрица предобуславливателя.

Начальные значения переменных:

- $\mathbf v = \mathbf p = \mathbf 0$,
- $\mathbf r = \mathbf{\hat r} = \mathbf b - A \mathbf x$.

Каждая итерация состоит из следующих шагов:

1. $\rho_\text{prev} = \rho$,
2. $\rho = (\mathbf{\hat r}, \mathbf r)$,
3. $\beta = (\rho \cdot \alpha) / (\rho_\text{prev} \cdot \omega)$,
4. $\mathbf p = \mathbf r + \beta \cdot (\mathbf p - \omega \mathbf v)$,
5. $\mathbf y = K \mathbf p$,
6. $\mathbf v = A \mathbf y$,
7. $\alpha = \rho / (\mathbf{\hat r}, \mathbf v)$,
8. $\mathbf s = \mathbf r - \alpha \mathbf v$,
9. $\mathbf z = K \mathbf s$,
10. $\mathbf t = A \mathbf z$,
11. $\omega = (\mathbf t, \mathbf s) / (\mathbf t, \mathbf t)$,
12. $\mathbf x = \mathbf x + \alpha \mathbf y + \omega \mathbf z$,
13. $d = \left\|A \mathbf x - \mathbf b\right\|$,
14. $\mathbf r = \mathbf s - \omega \mathbf t$.

Алгоритм заканчивается, когда $d$ будет меньше требуемой точности, или будет
достигнуто максимальное число итераций (1000).

В качестве предобуславливателя используется предобуславливатель Якоби
с матрицей $K = \omega_\text{prec} \cdot D^{-1}(A)$.

## Проведённые тесты

Были проведены испытания на сетке размера 400×400 при разных значениях $\tau$, $h$.
Результаты представлены в таблицах.

Предобуславливатель Якоби, константа релаксации = 1.0:

$\tau$ | $h$   | Невязка $V$ в $C$ | Невязка $V$ в $L_2$ | Невязка $G$ в $C$ | Невязка $G$ в $L_2$ | Время   | Время с Laspack
------ | ----- | ----------------- | ------------------- | ----------------- | ------------------- | ------- | ---------------
0.01   | 0.1   | 7.50319e-03       | 3.64456e-03         | 5.67781e-03       | 2.16841e-03         | 0.084 с | 0.134 с
0.005  | 0.1   | 4.24892e-03       | 1.98312e-03         | 2.72424e-03       | 1.05393e-03         | 0.152 с | 0.226 с
0.002  | 0.1   | 2.50841e-03       | 1.10019e-03         | 1.28251e-03       | 5.11068e-04         | 0.303 с | 0.450 с
0.001  | 0.1   | 1.60946e-03       | 6.58863e-04         | 5.76604e-04       | 2.54734e-04         | 0.604 с | 0.900 с
0.01   | 0.05  | 7.89901e-03       | 3.83866e-03         | 5.99325e-03       | 2.25824e-03         | 0.187 с | 0.253 с
0.005  | 0.05  | 4.63862e-03       | 2.17119e-03         | 3.03770e-03       | 1.14849e-03         | 0.320 с | 0.441 с
0.002  | 0.05  | 2.88840e-03       | 1.28051e-03         | 1.58939e-03       | 6.05611e-04         | 0.604 с | 0.836 с
0.001  | 0.05  | 1.98591e-03       | 8.26974e-04         | 8.77147e-04       | 3.42424e-04         | 1.203 с | 1.672 с
0.01   | 0.025 | 7.99694e-03       | 3.88950e-03         | 6.07108e-03       | 2.27641e-03         | 0.486 с | 0.586 с
0.005  | 0.025 | 4.73400e-03       | 2.21984e-03         | 3.11533e-03       | 1.16981e-03         | 0.724 с | 1.073 с
0.002  | 0.025 | 2.98192e-03       | 1.32691e-03         | 1.66568e-03       | 6.28168e-04         | 1.295 с | 1.876 с
0.001  | 0.025 | 2.07906e-03       | 8.71933e-04         | 9.52116e-04       | 3.64733e-04         | 2.413 с | 3.503 с
0.01   | 0.012 | 8.02115e-03       | 3.90346e-03         | 6.09068e-03       | 2.27900e-03         | 1.634 с | 1.660 с
0.005  | 0.012 | 4.75801e-03       | 2.23269e-03         | 3.13449e-03       | 1.17410e-03         | 1.975 с | 2.273 с
0.002  | 0.012 | 3.00662e-03       | 1.33969e-03         | 1.68454e-03       | 6.33201e-04         | 3.041 с | 3.722 с
0.001  | 0.012 | 2.10198e-03       | 8.83331e-04         | 9.70749e-04       | 3.70002e-04         | 5.283 с | 7.431 с

Предобуславливатель Якоби, константа релаксации = 1.5:

$\tau$ | $h$   | Невязка $V$ в $C$ | Невязка $V$ в $L_2$ | Невязка $G$ в $C$ | Невязка $G$ в $L_2$ | Время   | Время с Laspack
------ | ----- | ----------------- | ------------------- | ----------------- | ------------------- | ------- | ---------------
0.01   | 0.1   | 7.50319e-03       | 3.64456e-03         | 5.67781e-03       | 2.16841e-03         | 0.085 с | 0.127 с
0.005  | 0.1   | 4.24892e-03       | 1.98312e-03         | 2.72424e-03       | 1.05393e-03         | 0.153 с | 0.227 с
0.002  | 0.1   | 2.50841e-03       | 1.10019e-03         | 1.28251e-03       | 5.11068e-04         | 0.307 с | 0.454 с
0.001  | 0.1   | 1.60946e-03       | 6.58863e-04         | 5.76604e-04       | 2.54734e-04         | 0.613 с | 0.909 с
0.01   | 0.05  | 7.89901e-03       | 3.83866e-03         | 5.99325e-03       | 2.25824e-03         | 0.187 с | 0.254 с
0.005  | 0.05  | 4.63862e-03       | 2.17119e-03         | 3.03770e-03       | 1.14849e-03         | 0.321 с | 0.443 с
0.002  | 0.05  | 2.88840e-03       | 1.28051e-03         | 1.58939e-03       | 6.05611e-04         | 0.608 с | 0.840 с
0.001  | 0.05  | 1.98591e-03       | 8.26974e-04         | 8.77147e-04       | 3.42424e-04         | 1.210 с | 1.673 с
0.01   | 0.025 | 7.99694e-03       | 3.88950e-03         | 6.07108e-03       | 2.27641e-03         | 0.485 с | 0.580 с
0.005  | 0.025 | 4.73400e-03       | 2.21984e-03         | 3.11533e-03       | 1.16981e-03         | 0.723 с | 0.920 с
0.002  | 0.025 | 2.98192e-03       | 1.32691e-03         | 1.66568e-03       | 6.28168e-04         | 1.294 с | 1.703 с
0.001  | 0.025 | 2.07906e-03       | 8.71933e-04         | 9.52116e-04       | 3.64733e-04         | 2.414 с | 3.213 с
0.01   | 0.012 | 8.02115e-03       | 3.90346e-03         | 6.09068e-03       | 2.27900e-03         | 1.627 с | 1.655 с
0.005  | 0.012 | 4.75801e-03       | 2.23269e-03         | 3.13449e-03       | 1.17410e-03         | 1.964 с | 2.210 с
0.002  | 0.012 | 3.00662e-03       | 1.33969e-03         | 1.68454e-03       | 6.33201e-04         | 3.003 с | 3.654 с
0.001  | 0.012 | 2.10198e-03       | 8.83331e-04         | 9.70749e-04       | 3.70002e-04         | 5.259 с | 6.775 с

Без предобуславливателя:

$\tau$ | $h$   | Невязка $V$ в $C$ | Невязка $V$ в $L_2$ | Невязка $G$ в $C$ | Невязка $G$ в $L_2$ | Время   | Время с Laspack
------ | ----- | ----------------- | ------------------- | ----------------- | ------------------- | ------- | ---------------
0.01   | 0.1   | 7.50318e-03       | 3.64456e-03         | 5.67781e-03       | 2.16841e-03         | 0.081 с | 0.117 с
0.005  | 0.1   | 4.24892e-03       | 1.98312e-03         | 2.72424e-03       | 1.05393e-03         | 0.151 с | 0.214 с
0.002  | 0.1   | 2.50841e-03       | 1.10019e-03         | 1.28251e-03       | 5.11068e-04         | 0.278 с | 0.428 с
0.001  | 0.1   | 1.60946e-03       | 6.58863e-04         | 5.76604e-04       | 2.54734e-04         | 0.543 с | 0.827 с
0.01   | 0.05  | 7.89903e-03       | 3.83866e-03         | 5.99325e-03       | 2.25824e-03         | 0.171 с | 0.236 с
0.005  | 0.05  | 4.63881e-03       | 2.17129e-03         | 3.03777e-03       | 1.14849e-03         | 0.281 с | 0.411 с
0.002  | 0.05  | 2.88849e-03       | 1.28055e-03         | 1.58943e-03       | 6.05620e-04         | 0.552 с | 0.811 с
0.001  | 0.05  | 1.98591e-03       | 8.26975e-04         | 8.77147e-04       | 3.42424e-04         | 1.077 с | 1.557 с
0.01   | 0.025 | 7.99695e-03       | 3.88951e-03         | 6.07111e-03       | 2.27641e-03         | 0.387 с | 0.526 с
0.005  | 0.025 | 4.73388e-03       | 2.21976e-03         | 3.11531e-03       | 1.16986e-03         | 0.614 с | 0.855 с
0.002  | 0.025 | 2.98281e-03       | 1.32737e-03         | 1.66562e-03       | 6.28155e-04         | 1.126 с | 1.592 с
0.001  | 0.025 | 2.07901e-03       | 8.71909e-04         | 9.52125e-04       | 3.64735e-04         | 2.274 с | 3.080 с
0.01   | 0.012 | 8.02121e-03       | 3.90342e-03         | 6.09085e-03       | 2.27899e-03         | 1.133 с | 1.401 с
0.005  | 0.012 | 4.75811e-03       | 2.23274e-03         | 3.13442e-03       | 1.17409e-03         | 1.544 с | 2.028 с
0.002  | 0.012 | 3.00633e-03       | 1.33954e-03         | 1.68466e-03       | 6.33230e-04         | 2.904 с | 3.539 с
0.001  | 0.012 | 2.10238e-03       | 8.83517e-04         | 9.70858e-04       | 3.70033e-04         | 5.305 с | 6.506 с

### Анализ результатов на гладкость

Во всех проведённых тестах функция $V$ оказалась гладкой. Ниже приведена таблицы
для гладкости функции $G$.

Строка «почти» означает, что наблюдалась незначительная осцилляция.

**Для задачи № 3**:

$\mu$ | $p'$ | при $\eta > 0.1$ | при $\eta$ > 1 | при $\eta$ > 5
----- | ---- | ---------------- | -------------- | --------------
0.001 | 1    | нет              | нет            | почти
0.001 | 10   | нет              | да             | да
0.001 | 100  | да               | да             | да
0.01  | 1    | нет              | нет            | да
0.01  | 10   | нет              | почти          | да
0.01  | 100  | почти            | да             | да
0.1   | 1    | нет              | нет            | да
0.1   | 10   | нет              | почти          | да
0.1   | 100  | почти            | да             | да

**Для задачи № 4**:

$\mu$ | $p'$ | при $\eta > 0.1$ | при $\eta$ > 1 | при $\eta$ > 5
----- | ---- | ---------------- | -------------- | --------------
0.001 | 1    | нет              | нет            | почти
0.001 | 10   | да               | да             | да
0.001 | 100  | нет              | нет            | да
0.01  | 1    | нет              | нет            | да
0.01  | 10   | да               | да             | да
0.01  | 100  | нет              | нет            | да
0.1   | 1    | да               | да             | да
0.1   | 10   | да               | да             | да
0.1   | 100  | нет              | нет            | да
