<!--- type: markdown; required-extensions: mathjax smarty --->
<!--- Created with ReText: http://retext.sourceforge.net/ --->

Отчёт о численном решении системы уравнений Навье--Стокса.

## Постановка задачи

Дана система уравнений, описывающая одномерное нестационарное движение вязкого
баротропного газа:

$$
\left\{
\begin{align*}
& \frac{\partial\rho}{\partial t} + \frac{\partial\rho u}{\partial x} = 0,\\
& \rho\frac{\partial u}{\partial t} + \rho u\frac{\partial u}{\partial x} +
  \frac{\partial p}{\partial x} = \mu\frac{\partial^2 u}{\partial x^2} + \rho f
\end{align*}
\right.
$$

### Начальные условия в задачах № 1 и № 2

$$
\rho(x,\,0) = \rho_0(x) \\
u(x,\,0) = u_0(x) \\
u(0,\,t) = 0 \\
u(X,\,t) = 0
$$

### Начальные условия в задаче № 3

$$
\rho(x,\,0) =
\begin{cases}
1{,} & x \in (0,\,4.5) \\
2{,} & x \in (4.5,\,5.5) \\
1{,} & x \in (5.5,\,10)
\end{cases}
$$

$$
u(x,\,0) = 0{,}\quad x \in (0,\,10)
$$

$$
u(0,\,t) = 0 \\
u(10,\,t) = 0
$$

### Начальные условия в задаче № 4

$$
\rho(x,\,0) =
\begin{cases}
0{,} & x \in (0,\,4.5) \\
1{,} & x \in (4.5,\,5.5) \\
0{,} & x \in (5.5,\,10)
\end{cases}
$$

$$
u(x,\,0) = 1{,}\quad x \in (0,\,10)
$$

$$
u(0{,}\,t) = 0 \\
u(10{,}\,t) = 0
$$

### Обозначения

Переменная | Описание
---------- | --------
$x$        | пространственная координата
$t$        | время
$\rho$     | плотность газа
$p$        | давление газа, $p = p(\rho)$
$g$        | сокращение для $\ln p$
$u$        | скорость газа
$\mu$      | вязкость газа
$f$        | внешняя сила

### Линейная система

Пусть G_m, V_m --- значения сеточных приближений функций g и u
на $m$-ом узле, $m = 0, \dots, M$.

Возьмём

$$
\tilde\rho(x,\,t) = e^t \left( \cos \frac{\pi x}{10} + \frac{3}{2} \right), \\
\tilde{u}(x,\,t) = \cos 2\pi t \cdot \sin \frac{\pi x^2}{100}
$$

За $R_1(m)$ и $R_2(m)$ обозначим результаты применения дифференциальных
операторов из левой части системы к функциям $\tilde\rho$ и $\tilde{u}$.

Получим систему $2M+2$ уравнений с $2M+2$ неизвестными.

Линейное уравнение для $G$:

$$
- \hat{G}_{m-1} \cdot \frac{V_{m-1} + V_m}{4h}
- \hat{V}_{m-1} \cdot \frac{1}{2h}
+ \hat{G}_{m}   \cdot \frac{1}{\tau}
+ \hat{G}_{m+1} \cdot \frac{V_m + V_{m+1}}{4h}
+ \hat{V}_{m+1} \cdot \frac{1}{2h} = \\
= \frac{G_m}{\tau} + G_m \cdot \frac{V_{m+1} - V_{m-1}}{4h} +
  R_1(m)
$$

Начальное условие:

$$
  \hat{G}_0 \cdot \left( \frac{1}{\tau} - \frac{V_0}{2h} \right)
- \hat{V}_0 \cdot \frac{1}{h}
+ \hat{G}_1 \cdot \frac{V_1}{2h}
+ \hat{V}_1 \cdot \frac{1}{h} = \\
= \frac{G_0}{\tau} + G_0 \cdot \frac{V_1 - V_0}{2h} +
  \frac{G_2 V_2 - 2 G_1 V_1 + G_0 V_0 +
      \left( 2 - G_0 \right) \left( V_2 - 2 V_1 + V_0 \right)}{4h} +
  R_1(0)
$$

Конечное условие:

$$
- \hat{G}_{M-1} \cdot \frac{V_{M-1}}{2h}
- \hat{V}_{M-1} \cdot \frac{1}{h}
+ \hat{G}_{M}   \cdot \left( \frac{1}{\tau} + \frac{V_M}{2h} \right)
+ \hat{V}_{M}   \cdot \frac{1}{h} = \\
= \frac{G_M}{\tau} +
  \frac{G_M \left( V_M - V_{M-1} \right) }{2h} +
  \frac{G_M V_M - 2 G_{M-1} V_{M-1} + G_{M-2} V_{M-2} +
      \left( 2 - G_M \right) \left( V_M - 2 V_{M-1} + V_{M-2} \right) }{4h} +
  R_1(M)
$$

Линейное уравнение для $V$ (в случае нулевой вязкости):

$$
- \hat{G}_{m-1} \cdot \frac{\tilde{p}'}{2h}
- \hat{V}_{m-1} \cdot \left( \frac{V_{m-1} + V_m}{6h} + \frac{4}{3}\tilde\mu \right)
+ \hat{V}_{m}   \cdot \left( \frac{1}{\tau} + \frac{8}{3} \tilde\mu \right)
+ \hat{G}_{m+1} \cdot \frac{\tilde{p}'}{2h} = \\
+ \hat{V}_{m+1} \cdot \left( \frac{V_m + V_{m+1}}{6h} - \frac{4}{3}\tilde\mu \right)
= \frac{V_m}{\tau} +
  R_2(m)
$$

Оставшиеся два уравнения берутся из условий $\hat{V}_0$ = 0, $\hat{V}_M$ = 0.

## Организация хранения матрицы и векторов

Значения $G$ и $V$ располагаются по очереди: $G_0 V_0 G_1 V_1 \dots G_M V_M$.

Поскольку на главной диагонали все элементы с индексами одинаковой чётности
равны между собой, то из диагональной части матрицы хранятся только два элемента.

Остальные элементы хранятся в формате Modified Compressed Sparse Row (MSR),
в виде массива индексов и массива значений.

## Методы решения разреженных линейных систем

В программе реализован метод BiCGSTAB (стабилизированный метод бисопряжённых
градиентов) с предобуславливателем.

Кроме того, возможно подключение библиотеки LASPack, в которой реализованы
другие итерационные методы и предобуславливатели.

### Алгоритм метода BiCGSTAB

Пусть $A$ --- матрица системы, $\mathbf b$ --- правая часть, $\mathbf x$ ---
начальное приближение системы, $K$ --- матрица предобуславливателя.

Начальные значения переменных:

- $\mathbf v = \mathbf p = \mathbf 0$,
- $\mathbf r = \mathbf{\hat r} = \mathbf b - A \mathbf x$.

Каждая итерация состоит из следующих шагов:

1. $\rho_\text{prev} = \rho$,
2. $\rho = (\mathbf{\hat r}, \mathbf r)$,
3. $\beta = (\rho \cdot \alpha) / (\rho_\text{prev} \cdot \omega)$,
4. $\mathbf p = \mathbf r + \beta \cdot (\mathbf p - \omega \mathbf v)$,
5. $\mathbf y = K \mathbf p$,
6. $\mathbf v = A \mathbf y$,
7. $\alpha = \rho / (\mathbf{\hat r}, \mathbf v)$,
8. $\mathbf s = \mathbf r - \alpha \mathbf v$,
9. $\mathbf z = K \mathbf s$,
10. $\mathbf t = A \mathbf z$,
11. $\omega = (\mathbf t, \mathbf s) / (\mathbf t, \mathbf t)$,
12. $\mathbf x = \mathbf x + \alpha \mathbf y + \omega \mathbf z$,
13. $d = \left\|A \mathbf x - \mathbf b\right\|$,
14. $\mathbf r = \mathbf s - \omega \mathbf t$.

Алгоритм заканчивается, когда $d$ будет меньше требуемой точности, или будет
достигнуто максимальное число итераций (1000).

В качестве предобуславливателя используется предобуславливатель Якоби
с матрицей $K = \omega_\text{prec} \cdot D^{-1}(A)$.

## Проведённые тесты

Были проведены испытания на сетке размера 400×400 при разных значениях $\tau$, $h$.
Результаты представлены в таблице:

$\tau$      | $h$         | Невязка $V$ в $C$ | Невязка $V$ в $L_2$ | Невязка $G$ в $C$ | Невязка $G$ в $L_2$ | Время    | Время с Laspack
----------- | ----------- | ----------------- | ------------------- | ----------------- | ------------------- | -----    | ---------------
2.50627e-03 | 2.50627e-02 | 2.08565e-03       | 1.02849e-03         | 1.43495e-03       | 5.39350e-04         | 1.682 с  | 2.424 с
1.25156e-03 | 2.50627e-02 | 1.10104e-03       | 5.32001e-04         | 7.14881e-04       | 2.69397e-04         | 3.383 с  | 4.551 с
6.25391e-04 | 2.50627e-02 | 6.01320e-04       | 2.80338e-04         | 3.56732e-04       | 1.35181e-04         | 6.440 с  | 9.576 с
2.50627e-03 | 1.25156e-02 | 2.11002e-03       | 1.04097e-03         | 1.45481e-03       | 5.44843e-04         | 4.473 с  | 8.152 с
1.25156e-03 | 1.25156e-02 | 1.12532e-03       | 5.44123e-04         | 7.34616e-04       | 2.75298e-04         | 6.986 с  | 12.974 с
6.25391e-04 | 1.25156e-02 | 6.25383e-04       | 2.92187e-04         | 3.76392e-04       | 1.41248e-04         | 12.325 с | 22.891 с
2.50627e-03 | 6.25391e-03 | 2.11612e-03       | 1.04425e-03         | 1.45975e-03       | 5.45978e-04         | 10.467 с | 14.223 с
1.25156e-03 | 6.25391e-03 | 1.13137e-03       | 5.47243e-04         | 7.39548e-04       | 2.76651e-04         | 16.058 с | 22.040 с
6.25391e-04 | 6.25391e-03 | 6.31391e-04       | 2.95209e-04         | 3.81302e-04       | 1.42702e-04         | 25.220 с | 46.767 с

### Анализ результатов на гладкость

Во всех проведённых тестах функция $V$ оказалась гладкой. Ниже приведена таблицы
для гладкости функции $G$.

Строка «почти» означает, что наблюдалась незначительная осцилляция.

**Для задачи № 3**:

$\mu$ | $p'$ | при $\eta > 0.1$ | при $\eta$ > 1 | при $\eta$ > 5
----- | ---- | ---------------- | -------------- | --------------
0.001 | 1    | нет              | нет            | почти
0.001 | 10   | нет              | да             | да
0.001 | 100  | да               | да             | да
0.01  | 1    | нет              | нет            | да
0.01  | 10   | нет              | почти          | да
0.01  | 100  | почти            | да             | да
0.1   | 1    | нет              | нет            | да
0.1   | 10   | нет              | почти          | да
0.1   | 100  | почти            | да             | да

**Для задачи № 4**:

$\mu$ | $p'$ | при $\eta > 0.1$ | при $\eta$ > 1 | при $\eta$ > 5
----- | ---- | ---------------- | -------------- | --------------
0.001 | 1    | нет              | нет            | почти
0.001 | 10   | да               | да             | да
0.001 | 100  | нет              | нет            | да
0.01  | 1    | нет              | нет            | да
0.01  | 10   | да               | да             | да
0.01  | 100  | нет              | нет            | да
0.1   | 1    | да               | да             | да
0.1   | 10   | да               | да             | да
0.1   | 100  | нет              | нет            | да
